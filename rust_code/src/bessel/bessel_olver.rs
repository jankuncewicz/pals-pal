#[path = "cheb.rs"]
mod cheb;

/* fit for f(x) = zofmzeta((x+1)/2), 0 <= mzeta <= 1 */
const zofmzeta_a_data: [f64; 20] = [
  2.9332563730829348990,
  0.4896518224847036624,
  0.0228637617355380860,
 -0.0001715731377284693,
 -0.0000105927538148751,
  1.0595602530419e-6,
 -4.68016051691e-8,
  5.8310020e-12,
  1.766537581e-10,
 -1.45034640e-11,
  4.357772e-13,
  4.60971e-14,
 -2.57571e-14,
  2.26468e-14,
 -2.22053e-14,
  2.08593e-14,
 -1.84454e-14,
  1.50150e-14,
 -1.06506e-14,
  5.5375e-15
];

/* fit for f(x) = zofmzeta((9x+11)/2), 1 <= mzeta <= 10 */
const zofmzeta_b_data: [f64; 30] = [
  22.40725276466303489,
  10.39808258825165581,
  1.092050144486018425,
 -0.071111274777921604,
  0.008990125336059704,
 -0.001201950338088875,
  0.000106686807968315,
  0.000017406491576830,
 -0.000014946669657805,
  6.189984487752e-6,
 -2.049466715178e-6,
  5.87189458020e-7,
 -1.46077514157e-7,
  2.9803936132e-8,
 -3.817692108e-9,
 -4.66980416e-10,
  5.83860334e-10,
 -2.78825299e-10,
  1.01682688e-10,
 -3.1209928e-11,
  8.111122e-12,
 -1.663986e-12,
  1.81364e-13,
  5.3414e-14,
 -4.7234e-14,
  2.1689e-14,
 -7.815e-15,
  2.371e-15,
 -6.04e-16,
  1.20e-16
];

/* fit for f(x) = zofmzeta(mz(x))/mz(x)^(3/2),
 * mz(x) = (2/(x+1))^(2/3) 10
 * 10 <= mzeta <= Inf
 */
const zofmzeta_c_data: [f64; 11] = [
  1.3824761227122911500,
  0.0244856101686774245,
 -0.0000842866496282540,
  1.4656076569771e-6,
 -3.14874099476e-8,
  7.561134833e-10,
 -1.94531643e-11,
  5.245878e-13,
 -1.46380e-14,
  4.192e-16,
 -1.23e-17
];

/* Invert [Abramowitz+Stegun, 9.3.39].
 * Assumes minus_zeta >= 0.
 */
pub fn zofmzeta(minus_zeta: f64) -> f64 {
  if minus_zeta < 1.0 {
    let x = 2.0*minus_zeta - 1.0;
    return cheb::cheb_eval(x, &zofmzeta_a_data, -1.0, 1.0);
  }
  else if minus_zeta < 10.0 {
    let x = (2.0*minus_zeta - 11.0)/9.0;
    return cheb::cheb_eval(x, &zofmzeta_b_data, -1.0, 1.0);
  }
  else {
    const TEN_32: f64 = 31.62277660168379332; /* 10^(3/2) */
    let p = minus_zeta.powf(3.0/2.0);
    let x = 2.0*TEN_32/p - 1.0;
    return cheb::cheb_eval(x, &zofmzeta_c_data, -1.0, 1.0);
  }
}